<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>유저 선택창</title>
</head>
<!--  <link rel="stylesheet" th:href="@{/css/board.css}"/>-->
<body style="display: flex; margin-top: 10rem; height: 100vh">
  <div class="container" style="width: 50%; margin: 0 auto;">
    <h2>유저 목록</h2>
    <div><a th:href="@{/userAdd.do}" class="button">유저 등록</a></div>
    <table class="board_list">
      <colgroup>
        <col width="15%"/>
        <col width="*"/>
      </colgroup>
      <thead>
      <tr>
        <th scope="col">유저 번호</th>
        <th scope="col">유저 이름</th>
        <th scope="col">접속</th>
        <th scope="col">수정</th>
        <th scope="col">유저 삭제</th>
      </tr>
      </thead>
      <tbody>
      <tr th:if="${#lists.size(list)} > 0" th:each="list: ${list}">
        <td th:text="${list.id}"></td>
        <td th:text="${list.username}"></td>
        <td>
          <a th:href="@{/home(userId=${list.id})}" style="text-decoration: none; color: inherit; cursor: pointer;">선택</a>
        </td>
        <td>
          <a th:href="@{/userUpdate.do(userId=${list.id})}" style="text-decoration: none; color: inherit; cursor: pointer;">선택</a>
        </td>
        <td>
          <input type="button" th:onclick="|viewModal(${list.id})|" th:value="삭제"/>
        </td>
      </tr>
      <tr th:unless="${#lists.size(list)} > 0">
        <td colspan="4">조회된 결과가 없습니다.</td>
      </tr>
      </tbody>
    </table>
    <div id="modal" style="display: none; justify-content: center; padding: 1rem; border: 1px solid black; border-radius: 12px; flex-direction: column; gap:12px" >
      <span>해당 유저를 삭제하시겠습니까?</span>
      <div style="display:flex; gap: 1.5rem">
        <div onclick="confirmDelete()"
             style="padding-top: 0.5rem; padding-bottom: 0.5rem; padding-left: 0.75rem; padding-right: 0.75rem; cursor: pointer; background-color: #357abd; color: white; border-radius: 8px" >네</div>
        <div onclick="hideModal()"
             style="padding-top: 0.5rem; padding-bottom: 0.5rem; padding-left: 0.75rem; padding-right: 0.75rem; border: 1px solid black; cursor: pointer; color: black; border-radius: 8px">아니오</div>
      </div>
    </div>
    <script th:inline="javascript">
      deleteTargetId = null;
      function viewModal(userId) {
        console.log("onClickDeleteBtn")
        deleteTargetId = userId;
        document.getElementById("modal").style.display="flex";
      }

      function hideModal(){
        document.getElementById("modal").style.display="none";
      }

      function confirmDelete() {
        if (deleteTargetId) {
          fetch(`/user/delete?userId=${deleteTargetId}`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
          }).then(response => {
            if (response.ok) {
              location.reload();
            } else {
              alert('삭제 중 오류가 발생했습니다.');
            }
          }).catch(error => {
            alert('삭제 중 오류가 발생했습니다.');
          });
        }
        hideModal();
      }
    </script>
  </div>
</body>
</html>